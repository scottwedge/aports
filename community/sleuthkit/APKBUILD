# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=sleuthkit
pkgver=4.8.0
pkgrel=1
pkgdesc="File system and media management forensic analysis tools"
arch="all"
license="custom"
depends="perl"
url="http://www.sleuthkit.org/sleuthkit"
makedepends="autoconf automake libtool sqlite-dev"
options="libtool"
subpackages="$pkgname-static $pkgname-dev $pkgname-libs $pkgname-doc"
source="https://github.com/sleuthkit/sleuthkit/releases/download/sleuthkit-$pkgver/sleuthkit-$pkgver.tar.gz
	30_fix-manpages.patch
	40_no_static_ldflags.patch
	50_disable_ant_clean.patch
	https://github.com/micrictor/sleuthkit/commit/0c7d5e7333aeb61dace51750b56fcaad55a6359b.patch
	https://github.com/sleuthkit/sleuthkit/commit/459ae818fc8dae717549810150de4d191ce158f1.patch
	"

# secfixes:
#   4.8.0-r1:
#     - CVE-2020-10232
#     - CVE-2020-10233

build() {
	# https://github.com/sleuthkit/sleuthkit/issues/642
	export CFLAGS="$CFLAGS -DHAVE_LIBEWF_V2_API -Dlibewf_handle_read_random=libewf_handle_read_buffer_at_offset"
	export CXXFLAGS="$CXXFLAGS -Wno-error=cpp"
	./configure --prefix=/usr
	make
}

package() {
	make DESTDIR="$pkgdir" install
	install -d "$pkgdir"/usr/share/licenses/$pkgname
	install -Dm0644 licenses/* "$pkgdir"/usr/share/licenses/$pkgname

}

sha512sums="c7beec99471344cb6e0d2f2619788857120922eb67a83cc42f919890da6ec7cea48e7cf59bd546c04db73c0eab52657a8510bc86df44c574a51e59664fdfdb76  sleuthkit-4.8.0.tar.gz
4b68367bff62c731c09ab9a95f810b11562f0942021825226ca8d5e846e54c64004f77ac587ea0377bcb5c50c9dcb33dba1caa8cffd717076cc13c9931dd2c9c  30_fix-manpages.patch
e0421b2fc4bb1d04d3bdb13805d060b386f700586d9e33728185eaff26eef14d5fdbf89979fb5d898dfeee7467f891b5d3c33441f9cb35af5f93d3d576e7cc26  40_no_static_ldflags.patch
cb0d17840f1b4570da1ee0d092f8716a7e073463658d4a7b1cddb74058c5eccf316fcbd2e7c5fba3af0f0adaaabe4e395bd5a41aa1438be615edacb8c6efd89d  50_disable_ant_clean.patch
c80a3c0f469f8487b6942f0d1a2037d2015a6de6db5868c3ff06406a1792e6c1858cc7a63640fc998e41f8ba3a31fdc1168ba7c3091e876cf13be5fefe46ff72  0c7d5e7333aeb61dace51750b56fcaad55a6359b.patch
8a37a5ab395dae29593cb6cdf94870304d7c0a4513a7fdd600cb1e23824d4346a7696ab72562047a37f45811a0d4e7f0d979cccb0f6b5b5e74b92211cfcb8396  459ae818fc8dae717549810150de4d191ce158f1.patch"
